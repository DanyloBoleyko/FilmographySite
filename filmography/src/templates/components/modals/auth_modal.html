{% extends 'components/modal.html' %}

{% block content %}
    <form id="auth-form" action="{% url 'login' %}" method="post">
        {% csrf_token %}
        <label>
            <span class="label">Login:</span>
            <input id="login-field" class="text-field mb-4" type="text">
        </label>
        <label>
            <span class="label">Password:</span>
            <input id="password-field" class="text-field" type="password">
        </label>
        <div id="auth-error" class="error-message mt-4" style="display: none"></div>

        <hr>

        <button id="auth-button" type="submit" class="button primary-button">Log in</button>
    </form>

    <a href="{% url 'logout' %}">Logout</a>

    <script>
        const authForm = document.getElementById('auth-form');
        const loginField = document.getElementById('login-field');
        const passwordField = document.getElementById('password-field');
        const authError = document.getElementById('auth-error');

        authForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(authForm);
            fetch(authForm.action, {
                method: 'POST',
                body: formData,
            })
                .then(response => {
                    if (response.ok) {
                        {#window.location.reload(); // Refresh the page to apply the authenticated state#}
                    } else {
                        throw new Error('Authentication failed');
                    }
                })
                .catch(error => {
                    authError.style.display = 'block';
                    authError.innerText = error.message;
                });
        });
    </script>
{% endblock %}